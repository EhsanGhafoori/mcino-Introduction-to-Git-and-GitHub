@using EventEase.Models
@using EventEase.Services
@using System.ComponentModel.DataAnnotations

<div class="registration-form">
    <EditForm Model="@registrationModel" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        
        <div class="form-group">
            <label>Full Name:</label>
            <InputText @bind-Value="registrationModel.FullName" class="form-control" />
            <ValidationMessage For="@(() => registrationModel.FullName)" />
        </div>
        
        <div class="form-group">
            <label>Email:</label>
            <InputText @bind-Value="registrationModel.Email" class="form-control" type="email" />
            <ValidationMessage For="@(() => registrationModel.Email)" />
        </div>
        
        <div class="form-group">
            <label>Phone:</label>
            <InputText @bind-Value="registrationModel.Phone" class="form-control" />
            <ValidationMessage For="@(() => registrationModel.Phone)" />
        </div>
        
        <div class="form-group">
            <label>Event:</label>
            <InputSelect @bind-Value="registrationModel.SelectedEventId" class="form-control">
                <option value="">Select an event...</option>
                @foreach (var evt in availableEvents)
                {
                    <option value="@evt.Id">@evt.Title - @evt.Date.ToString("MM/dd/yyyy")</option>
                }
            </InputSelect>
            <ValidationMessage For="@(() => registrationModel.SelectedEventId)" />
        </div>
        
        <div class="form-group">
            <label>Additional Notes:</label>
            <InputTextArea @bind-Value="registrationModel.Notes" class="form-control" rows="3" />
        </div>
        
        <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
            @if (isSubmitting)
            {
                <span>Submitting...</span>
            }
            else
            {
                <span>Register</span>
            }
        </button>
    </EditForm>
</div>

@code {
    [Parameter]
    public EventCallback<string> OnRegistrationComplete { get; set; }

    [Inject]
    private EventService EventService { get; set; } = null!;

    private RegistrationModel registrationModel = new RegistrationModel();
    private List<Event> availableEvents = new List<Event>();
    private bool isSubmitting = false;

    protected override void OnInitialized()
    {
        availableEvents = EventService.GetAllEvents();
    }

    private async Task HandleSubmit()
    {
        isSubmitting = true;
        
        // Simulate registration process
        await Task.Delay(500);
        
        var selectedEvent = availableEvents.FirstOrDefault(e => e.Id == registrationModel.SelectedEventId);
        var message = $"Thank you, {registrationModel.FullName}! You have successfully registered for {selectedEvent?.Title ?? "the event"}.";
        
        await OnRegistrationComplete.InvokeAsync(message);
        
        // Reset form
        registrationModel = new RegistrationModel();
        isSubmitting = false;
    }

    public class RegistrationModel
    {
        [Required(ErrorMessage = "Full name is required")]
        [StringLength(100, ErrorMessage = "Name cannot exceed 100 characters")]
        public string FullName { get; set; } = string.Empty;

        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string Email { get; set; } = string.Empty;

        [Required(ErrorMessage = "Phone number is required")]
        [Phone(ErrorMessage = "Invalid phone number")]
        public string Phone { get; set; } = string.Empty;

        [Required(ErrorMessage = "Please select an event")]
        public int SelectedEventId { get; set; }

        public string Notes { get; set; } = string.Empty;
    }
}
